library(dplyr)
library(mosaic)
setwd("F:\\JerryCode\\BCIT-Assignments\\CST\\Term3\\MATH3042\\Labs\\Lab5")
data.file <- "SFU.Weather.with.Precip.csv"
SFU.Weather <- read.csv(data.file,
colClasses = c("Date", "numeric",
"character", "numeric",
"numeric", "numeric",
"numeric"))
#1
dow <- weekdays(SFU.Weather$Date)
SFU.Weather$dow <- dow
SFU.Weather <- filter(SFU.Weather, !is.na(Temp.deg.C), !is.na(Total.Precip.mm))
Monthly.Mean.Temp <- mean(Temp.deg.C ~ Month, data=SFU.Weather)
Monthly.SD.Temp <- sd(Temp.deg.C ~ Month, data=SFU.Weather)
barplot(Monthly.Mean.Temp[c("Jan", "Feb", "Mar", "Apr",
"May", "Jun", "Jul", "Aug",
"Sep", "Oct", "Nov", "Dec")],
main = paste("Mean Daily Temperature by Month at SFU (n=",
nrow(SFU.Weather),
")"),
xlab = "Month",
ylab = "Mean Daily Temp (deg C)")
#2
z.Temp.Anomaly <- with(SFU.Weather,
(Temp.deg.C - Monthly.Mean.Temp[Month])/
Monthly.SD.Temp[Month])
SFU.Weather$z.Temp.Anomaly <- z.Temp.Anomaly
histogram(~z.Temp.Anomaly,
data = SFU.Weather,
col="#9DC3FA",
breaks = 50,
xlim = c(-5,5),
fit="normal")
# 找出缺失的行
Missing.Rows <- SFU.Weather %>%
filter(is.na(Temp.deg.C) | is.na(Total.Precip.mm))
# 打印缺失行的数量
nrow(Missing.Rows)
# 打印缺失行的日期
Missing.Rows$Date
> # 找出缺失的行
hist(SFU.Weather$z.Temp.Anomaly)
histogram(~z.Temp.Anomaly,
data = SFU.Weather,
col="#9DC3FA",
breaks = 50,
xlim = c(-5,5),
fit="normal")
#Q3
P.cold <- sum(SFU.Weather$Temp.seg == "cold")/ nrow(SFU.Weather)
#Q3
P.cold <- sum(SFU.Weather$Temp.seg == "Cold")/ nrow(SFU.Weather)
P.Mid <- sum(SFU.Weather$$Temp.seg == "Mid") / nrow(SFU.Weather)
P.Warm <- sum(SFU.Weather$$Temp.seg == "Warm") / nrow(SFU.Weather)
P.Mid <- sum(SFU.Weather$Temp.seg == "Mid") / nrow(SFU.Weather)
P.Warm <- sum(SFU.Weather$Temp.seg == "Warm") / nrow(SFU.Weather)
P.Warm
P.cold
SFU.Weather$Tem.Seg <- ifelse(SFU.Weather$z.Temp.Anomaly < -0.4307, "Cold",
ifelse(SFU.Weather$z.Temp.Anomaly <= 0.4307, "Mid",
"Warm"
)
)
#Q3
P.cold <- sum(SFU.Weather$Temp.seg == "Cold")/ nrow(SFU.Weather)
P.Mid <- sum(SFU.Weather$Temp.seg == "Mid") / nrow(SFU.Weather)
P.Warm <- sum(SFU.Weather$Temp.seg == "Warm") / nrow(SFU.Weather)
SFU.Weather$Tem.Seg <- ifelse(SFU.Weather$z.Temp.Anomaly < -0.4307, "Cold",
ifelse(SFU.Weather$z.Temp.Anomaly <= 0.4307, "Mid",
"Warm"
)
)
P.Cold
#Q3
P.Cold <- sum(SFU.Weather$Temp.seg == "Cold")/ nrow(SFU.Weather)
P.Mid <- sum(SFU.Weather$Temp.seg == "Mid") / nrow(SFU.Weather)
P.Warm <- sum(SFU.Weather$Temp.seg == "Warm") / nrow(SFU.Weather)
P.Cold
#Q3
P.Cold <- sum(SFU.Weather$Temp.Seg == "Cold")/ nrow(SFU.Weather)
P.Mid <- sum(SFU.Weather$Temp.Seg == "Mid") / nrow(SFU.Weather)
P.Warm <- sum(SFU.Weather$Temp.Seg == "Warm") / nrow(SFU.Weather)
P.Cold <- sum(SFU.Weather$Temp.Seg == "Cold")/ nrow(SFU.Weather)
P.Mid <- sum(SFU.Weather$Temp.Seg == "Mid") / nrow(SFU.Weather)
P.Warm <- sum(SFU.Weather$Temp.Seg == "Warm") / nrow(SFU.Weather)
P.Cold
source("~/.active-rstudio-document", echo = TRUE)
Monthly.Mean.Temp <- mean(~Temp.deg.C | Month, data=SFU.Weather)
Monthly.SD.Temp <- sd(~Temp.deg.C | Month, data=SFU.Weather)
barplot(Monthly.Mean.Temp[c("Jan", "Feb", "Mar", "Apr",
"May", "Jun", "Jul", "Aug",
"Sep", "Oct", "Nov", "Dec")],
main = paste("Mean Daily Temperature by Month at SFU (n=",
nrow(SFU.Weather),
")"),
xlab = "Month",
ylab = "Mean Daily Temp (deg C)")
#Q2
z.Temp.Anomaly <- with(SFU.Weather,
(Temp.deg.C - Monthly.Mean.Temp[Month])/
Monthly.SD.Temp[Month])
SFU.Weather$z.Temp.Anomaly <- z.Temp.Anomaly
hist(SFU.Weather$z.Temp.Anomaly)
histogram(~z.Temp.Anomaly,
data = SFU.Weather,
col="#9DC3FA",
breaks = 50,
xlim = c(-5,5),
fit="normal")
library(dplyr)
library(mosaic)
setwd("F:/JerryCode/BCIT-Assignments/CST/Term3/MATH3042/Labs/Lab5")
data.file <- "SFU.Weather.with.Precip.csv"
SFU.Weather <- read.csv(data.file,
colClasses = c("Date", "numeric",
"character", "numeric",
"numeric", "numeric",
"numeric"))
#Q1
dow <- weekdays(SFU.Weather$Date)
SFU.Weather$dow <- dow
SFU.Weather <- filter(SFU.Weather, !is.na(Temp.deg.C), !is.na(Total.Precip.mm))
Monthly.Mean.Temp <- mean(Temp.deg.C ~ Month, data=SFU.Weather)
Monthly.SD.Temp <- sd(Temp.deg.C ~ Month, data=SFU.Weather)
barplot(Monthly.Mean.Temp[c("Jan", "Feb", "Mar", "Apr",
"May", "Jun", "Jul", "Aug",
"Sep", "Oct", "Nov", "Dec")],
main = paste("Mean Daily Temperature by Month at SFU (n=",
nrow(SFU.Weather),
")"),
xlab = "Month",
ylab = "Mean Daily Temp (deg C)")
z.Temp.Anomaly <- with(SFU.Weather,
(Temp.deg.C - Monthly.Mean.Temp[Month]) /
Monthly.SD.Temp[Month])
SFU.Weather$z.Temp.Anomaly <- z.Temp.Anomaly
hist(SFU.Weather$z.Temp.Anomaly)
histogram(~z.Temp.Anomaly,
data = SFU.Weather,
col="#9DC3FA",
breaks = 50,
xlim = c(-5,5),
xlab = "Z score of Temperature (adjusted for Month)",
main = "Standardized Temperature Anomaly",
fit="normal")
histogram(~z.Temp.Anomaly,
data = SFU.Weather,
col="#9DC3FA",
type = "density"
breaks = 50,
histogram(~z.Temp.Anomaly,
data = SFU.Weather,
col="#9DC3FA",
type = "density",
breaks = 50,
xlim = c(-5,5),
xlab = "Z score of Temperature (adjusted for Month)",
main = "Standardized Temperature Anomaly",
fit="normal")
histogram(~z.Temp.Anomaly,
data = SFU.Weather,
col="#9DC3FA",
type = "density",
nint = 40,
breaks = 50,
xlim = c(-5,5),
xlab = "Z score of Temperature (adjusted for Month)",
main = "Standardized Temperature Anomaly",
fit="normal")
histogram(~z.Temp.Anomaly,
data = SFU.Weather,
col="#9DC3FA",
type = "density",
breaks = 50,
xlim = c(-5,5),
xlab = "Z score of Temperature (adjusted for Month)",
main = "Standardized Temperature Anomaly",
fit="normal")
P.Cold <- sum(SFU.Weather$Temp.Seg == "Cold")/ nrow(SFU.Weather)
P.Mid <- sum(SFU.Weather$Temp.Seg == "Mid") / nrow(SFU.Weather)
P.Warm <- sum(SFU.Weather$Temp.Seg == "Warm") / nrow(SFU.Weather)
SFU.Weather$Temp.Seg <- ifelse(SFU.Weather$z.Temp.Anomaly < -0.4307, "Cold",
ifelse(SFU.Weather$z.Temp.Anomaly <= 0.4307, "Mid",
"Warm"
)
)
P.Cold <- sum(SFU.Weather$Temp.Seg == "Cold")/ nrow(SFU.Weather)
P.Mid <- sum(SFU.Weather$Temp.Seg == "Mid") / nrow(SFU.Weather)
P.Warm <- sum(SFU.Weather$Temp.Seg == "Warm") / nrow(SFU.Weather)
P.Cold; P.Mid; P.Warm
P.Cold + P.Mid + P.Warm
histogram(~z.Temp.Anomaly,
data = SFU.Weather,
col="#9DC3FA",
type = "density",
nint = 50,
xlim = c(-5,5),
xlab = "Z score of Temperature (adjusted for Month)",
main = "Standardized Temperature Anomaly",
fit="normal")
P.Cold <- sum(SFU.Weather$Temp.Seg == "Cold")/ nrow(SFU.Weather)
P.Mid <- sum(SFU.Weather$Temp.Seg == "Mid") / nrow(SFU.Weather)
P.Warm <- sum(SFU.Weather$Temp.Seg == "Warm") / nrow(SFU.Weather)
P.Cold; P.Mid; P.Warm
P.Cold + P.Mid + P.Warm
SFU.weather$Precipitation <- (SFU.weather$Total.Precip.mm > 0)
SFU.Weather$Precipitation <- (SFU.Weather$Total.Precip.mm > 0)
SFU.Weather$Day.of.Week <- weekdays(SFU.Weather$Date)
dow.tab <- table(SFU.Weather[c("Day.of.Week","Precipitation")])
dow.tab["Monday","TRUE"] / rowSums(dow.tab)["Monday"]
#Q4
SFU.Weather$Season <- with(SFU.Weather, dplyr::case_when(
Month %in% c("Jun","Jul","Aug") ~ "Summer",
Month %in% c("Sep","Oct","Nov") ~ "Autumn",
Month %in% c("Dec","Jan","Feb") ~ "Winter",
Month %in% c("Mar","Apr","May") ~ "Spring",
TRUE ~ NA_character_
))
SFU.Weather$Season <- factor(SFU.Weather$Season,
levels = c("Summer","Autumn","Winter","Spring"))
Seasonal.Mean.Precip <- mosaic::mean(Total.Precip.mm ~ Season, data = SFU.Weather)
barplot(Seasonal.Mean.Precip[c("Summer","Autumn","Winter","Spring")],
main = paste("Seasonal Mean Daily Precip. at SFU (n=", nrow(SFU.Weather), ")"),
xlab = "Season",
ylab = "Mean Daily Precipitation (mm)",
ylim = c(0, max(Seasonal.Mean.Precip, na.rm = TRUE) * 1.15))
SFU.Weather$Precipitation <- (SFU.Weather$Total.Precip.mm > 0)
SFU.Weather$Day.of.Week <- weekdays(SFU.Weather$Date)
dow.tab <- table(SFU.Weather[c("Day.of.Week","Precipitation")])
dow.tab["Monday","TRUE"] / rowSums(dow.tab)["Monday"]
SFU.Weather$Precipitation <- SFU.Weather$Total.Precip.mm > 0
SFU.Weather$Day.of.Week  <- weekdays(SFU.Weather$Date)
dow.tab <- table(SFU.Weather[c("Day.of.Week","Precipitation")])
dow.tab["Monday","TRUE"] / rowSums(dow.tab)["Monday"]
ylim = c(0, 10)
barplot(Seasonal.Mean.Precip[c("Summer","Autumn","Winter","Spring")],
main = paste("Seasonal Mean Daily Precip. at SFU (n=", nrow(SFU.Weather), ")"),
xlab = "Season",
ylab = "Mean Daily Precipitation (mm)",
ylim = c(0, 10))
# ——确保 Day.of.Week 为英文（如果你已经做过，可略过这三行）
w <- as.POSIXlt(SFU.Weather$Date)$wday
dow_levels <- c("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday")
SFU.Weather$Day.of.Week <- factor(dow_levels[w + 1], levels = dow_levels)
# ——1) 无条件概率  P(Precip > 0)
p_any <- mean(SFU.Weather$Precipitation, na.rm = TRUE)
# ——2) 条件概率  P(Precip > 0 | Monday)
p_monday <- with(SFU.Weather,
mean(Precipitation[Day.of.Week == "Monday"], na.rm = TRUE))
# ——(可选) 乘法判据：P(A∩M)  vs  P(A)P(M)
p_M     <- mean(SFU.Weather$Day.of.Week == "Monday")
p_joint <- with(SFU.Weather,
mean((Day.of.Week == "Monday") & Precipitation, na.rm = TRUE))
# ——差异量，便于在 PDF 里说明是否“近似相等”
delta_cond <- p_monday - p_any            # 条件概率与无条件概率之差
delta_mult <- p_joint - p_any * p_M       # 乘法公式的偏差
round(c(P_any = p_any,
P_Precip_given_Mon = p_monday,
P_Mon = p_M,
P_joint = p_joint,
diff_cond = delta_cond,
diff_mult = delta_mult), 4)
# 有降水的概率
p_any <- mean(SFU.Weather$Total.Precip.mm > 0, na.rm = TRUE)
# 星期一的条件概率（Sunday=0, Monday=1）
w <- as.POSIXlt(SFU.Weather$Date)$wday
p_mon <- mean((SFU.Weather$Total.Precip.mm > 0)[w == 1], na.rm = TRUE)
# 是否独立（近似判断阈值可用 0.01）
independent <- abs(p_mon - p_any) < 0.01
c(P_any = p_any, P_precip_given_Mon = p_mon, independent = independent)
p_any <- mean(SFU.Weather$Total.Precip.mm > 0, na.rm = TRUE)
w <- as.POSIXlt(SFU.Weather$Date)$wday
p_mon <- mean((SFU.Weather$Total.Precip.mm > 0)[w == 1], na.rm = TRUE)
independent <- abs(p_mon - p_any) < 0.01
c(P_any = p_any, P_precip_given_Mon = p_mon, independent = independent)
data.frame(P_any = p_any, P_mon = p_mon,
independent = abs(p_mon - p_any) < 0.01)
p_any <- mean(SFU.Weather$Total.Precip.mm > 0, na.rm = TRUE)
w <- as.POSIXlt(SFU.Weather$Date)$wday
p_mon <- mean((SFU.Weather$Total.Precip.mm > 0)[w == 1], na.rm = TRUE)
independent <- abs(p_mon - p_any) < 0.01
data.frame(P_any = p_any, P_mon = p_mon,
independent = abs(p_mon - p_any) < 0.01)
tab6 <- table(SFU.Weather$Temp.Seg, SFU.Weather$Precipitation)
P_cold <- prop.table(tab6, 1)["Cold","TRUE"]
P_mid  <- prop.table(tab6, 1)["Mid","TRUE"]
P_warm <- prop.table(tab6, 1)["Warm","TRUE"]
c(P_cold = P_cold, P_mid = P_mid, P_warm = P_warm)
SFU.Weather$Temp.Seg <- factor(SFU.Weather$Temp.Seg, levels = c("Cold","Mid","Warm"))
tab <- table(SFU.Weather$Temp.Seg, SFU.Weather$Total.Precip.mm > 0)
tab
prop <- prop.table(tab, 1)[, "TRUE"]
names(prop) <- c("P(>0|Cold)", "P(>0|Mid)", "P(>0|Warm)")
prop
SFU.Weather$Temp.Seg <- factor(SFU.Weather$Temp.Seg, levels = c("Cold","Mid","Warm"))
tab <- table(SFU.Weather$Temp.Seg, SFU.Weather$Total.Precip.mm > 0)
prop <- prop.table(tab, 1)[, "TRUE"]
names(prop) <- c("P(>0|Cold)", "P(>0|Mid)", "P(>0|Warm)")
prop
tab <- table(SFU.Weather$Temp.Seg, SFU.Weather$Total.Precip.mm > 0)
P_warm_given_precip <- tab["Warm","TRUE"] / sum(tab[,"TRUE"])
P_warm   <- sum(tab["Warm",]) / sum(tab)
P_precip <- sum(tab[,"TRUE"]) / sum(tab)
P_precip_given_warm <- tab["Warm","TRUE"] / sum(tab["Warm",])
P_warm_given_precip2 <- P_precip_given_warm * P_warm / P_precip
c(direct = P_warm_given_precip, bayes = P_warm_given_precip2)
P_warm   <- sum(tab["Warm",]) / sum(tab)
P_precip <- sum(tab[,"TRUE"]) / sum(tab)
P_precip_given_warm <- tab["Warm","TRUE"] / sum(tab["Warm",])
P_precip_given_warm * P_warm / P_precip
tab <- with(SFU.Weather, table(Season, Temp.Seg, Total.Precip.mm > 0))
p <- prop.table(tab[, "Warm", ], 1)[, "TRUE"]
p <- p[c("Summer","Autumn","Winter","Spring")]
round(p, 4)
tab <- with(SFU.Weather, table(Temp.Seg, Season, Total.Precip.mm > 0))
p <- prop.table(tab["Warm", , ], 1)[, "TRUE"]
round(p, 5)
months <- c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec")
tab <- with(SFU.Weather, table(Month, Temp.Seg, Total.Precip.mm > 0))
p <- prop.table(tab[, "Warm", ], 1)[, "TRUE"]
p <- p[months]
best_month <- names(which.max(p))
best_value <- unname(max(p))
round(p, 5); best_month; best_value
barplot(p, xlab="Month", ylab="P(Precip>0 | Warm)", main="Effect of Warmth on Likelihood of Precip", ylim=c(0,1))
