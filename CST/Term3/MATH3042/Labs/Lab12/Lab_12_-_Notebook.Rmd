---
title: "Lab 12 - Correlation and Regression"
date: Nov 27, 2025
author: Jerry Xing
output: word_document
---

```{R setup, include=FALSE}
library(MASS)
library(dplyr)
data(survey)
```

### Question 1
```{R}
X <- survey$Age
Y <- survey$Height

cor(X, Y, use = "complete.obs")
cor.test(X, Y, alternative = "two.sided")

CorrelationTest <- function(X.data, Y.data, X.label, Y.label, alpha) {
  valid <- complete.cases(X.data, Y.data)
  test <- cor.test(X.data[valid], Y.data[valid], alternative = "two.sided")
  level <- alpha * 100
  pval <- signif(test$p.value, 4)
  if (test$p.value < alpha) {
    paste0("At the ", level, 
           "% significance level, we have evidence of linear correlation between ", 
           X.label,  " and ",  Y.label, 
           " (p-value = ", pval, ").")
  } else {
    paste0("At the ", level, 
           "% significance level, we do not have evidence of linear correlation between ", 
           X.label, " and ", Y.label,
           " (p-value = ", pval, ").")
  }
}

CorrelationTest(X, Y, "student age", "student height", 0.05)
```

### Question2
```{R}
cor(survey$Wr.Hnd, survey$NW.Hnd, use = "complete.obs")
```

### Question3
```{R}
CorrelationTest(survey$Wr.Hnd, survey$NW.Hnd, "writing hand span", "non-writing hand span", 0.05)
```

### Question4
```{R}
plot(survey$Wr.Hnd, survey$NW.Hnd,
     xlab = "Writing hand span (cm)",
     ylab = "Non-writing hand span (cm)",
     main = "Writing vs non-writing hand span")
```

### Question5
```{R}
model <- lm(NW.Hnd ~ Wr.Hnd, data = survey)
b <- coef(model)
x0 <- 20
b[1] + b[2] * x0
```
### Question6
```{R}
cor(survey$Height, survey$NW.Hnd, use = "complete.obs")
```
**This correlation coefficient is smaller. The lengths of the left and right hands come from different parts of the same organ, so their correlation is stronger. Although height is related to hand length, the relationship is not as direct, so the correlation is weaker. This matches our expectations.**

### Question7
```{R}
CorrelationTest(survey$Height, survey$NW.Hnd, "student height", "non-writing hand span", 0.05)
```

### Question8
```{R}
plot(survey$Height, survey$NW.Hnd,
     xlab = "Height (cm)",
     ylab = "Non-writing hand span (cm)",
     main = "Height vs non-writing hand span")

abline(lm(NW.Hnd ~ Height, data = survey))
```

### Question9
```{R}
model_height <- lm(NW.Hnd ~ Height, data = survey)
new_student <- data.frame(Height = 173)
predict(model_height, new_student, interval = "predict", level = 0.95)
```
**We are 95% confident that for a student with a height of 173 cm, the predicted value of the non-writing hand length is the “fit” shown in the output above, and the corresponding 95% prediction interval is from 15.55958 to 21.93034.**

### Question10
```{R}
summary(model)$sigma
summary(model_height)$sigma
```
**Wider. Because the correlation coefficient between Height and NW.Hnd is smaller in Q6, the residual standard error becomes larger and the model has weaker explanatory power for NW.Hnd, resulting in greater prediction uncertainty.**

### Question11
```{R}
x <- survey$Height
y <- survey$NW.Hnd
valid <- complete.cases(x, y)
x <- x[valid]
y <- y[valid]
n <- length(x)

model_height <- lm(y ~ x)
a <- coef(model_height)[1]
b <- coef(model_height)[2]

x0 <- 173
yhat <- a + b * x0

Se <- sqrt((sum(y^2) - a * sum(y) - b * sum(x * y)) / (n - 2))

alpha <- 0.05
tcrit <- qt(1 - alpha / 2, df = n - 2)
sx <- sd(x)

E <- tcrit * Se * sqrt(1 + 1 / n + (x0 - mean(x))^2 / ((n - 1) * sx^2))

c(yhat - E, yhat + E)
```
